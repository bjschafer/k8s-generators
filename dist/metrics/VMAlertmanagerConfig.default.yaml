apiVersion: operator.victoriametrics.com/v1beta1
kind: VMAlertmanagerConfig
metadata:
  name: default
  namespace: metrics
spec:
  inhibit_rules:
    - equal:
        - alertname
      source_matchers:
        - severity="critical"
      target_matchers:
        - severity="warning"
  receivers:
    - email_configs:
        - auth_password:
            key: email_pass
            name: alertmanager-secrets
          auth_username: braxton@cmdcentral.xyz
          from: alertmanager@cmdcentral.xyz
          hello: alertmanager@cmdcentral.xyz
          require_tls: false
          smarthost: smtp.fastmail.com:465
          to: braxton@cmdcentral.xyz
      name: email
    - name: telegram
      telegram_configs:
        - api_url: https://api.telegram.org
          bot_token:
            key: telegram_bot_token
            name: alertmanager-secrets
          chat_id: 834388479
    - name: pushover
      pushover_configs:
        - priority: "{{if .CommonLabels.priority }}{{$CommonLabels.priority}}{{else}}0{{end}}"
          token:
            key: pushover_token
            name: alertmanager-secrets
          user_key:
            key: pushover_user_key
            name: alertmanager-secrets
    - name: blackhole
  route:
    receiver: blackhole
    routes:
      - matchers:
          - push_notify="true"
        receiver: pushover
      - matchers:
          - priority=~"0|1"
        receiver: pushover
