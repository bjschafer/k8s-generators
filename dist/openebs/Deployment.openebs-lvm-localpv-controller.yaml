apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: openebs-lvm-controller
    chart: lvm-localpv-1.6.2
    component: openebs-lvm-controller
    heritage: Helm
    openebs.io/component-name: openebs-lvm-controller
    openebs.io/version: 1.6.1
    release: openebs
    role: openebs-lvm
  name: openebs-lvm-localpv-controller
spec:
  replicas: 1
  selector:
    matchLabels:
      app: openebs-lvm-controller
      component: openebs-lvm-controller
      release: openebs
  template:
    metadata:
      labels:
        app: openebs-lvm-controller
        chart: lvm-localpv-1.6.2
        component: openebs-lvm-controller
        heritage: Helm
        name: openebs-lvm-controller
        openebs.io/component-name: openebs-lvm-controller
        openebs.io/version: 1.6.1
        release: openebs
        role: openebs-lvm
    spec:
      containers:
        - args:
            - --v=5
            - --csi-address=$(ADDRESS)
          env:
            - name: ADDRESS
              value: /var/lib/csi/sockets/pluginproxy/csi.sock
          image: registry.k8s.io/sig-storage/csi-resizer:v1.8.0
          imagePullPolicy: IfNotPresent
          name: csi-resizer
          resources: {}
          volumeMounts:
            - mountPath: /var/lib/csi/sockets/pluginproxy/
              name: socket-dir
        - args:
            - --csi-address=$(ADDRESS)
          env:
            - name: ADDRESS
              value: /var/lib/csi/sockets/pluginproxy/csi.sock
          image: registry.k8s.io/sig-storage/csi-snapshotter:v6.2.2
          imagePullPolicy: IfNotPresent
          name: csi-snapshotter
          resources: {}
          volumeMounts:
            - mountPath: /var/lib/csi/sockets/pluginproxy/
              name: socket-dir
        - args:
            - --v=5
          image: registry.k8s.io/sig-storage/snapshot-controller:v6.2.2
          imagePullPolicy: IfNotPresent
          name: snapshot-controller
          resources: {}
        - args:
            - --csi-address=$(ADDRESS)
            - --v=5
            - --feature-gates=Topology=true
            - --strict-topology
            - --enable-capacity=true
            - --extra-create-metadata=true
            - --default-fstype=ext4
          env:
            - name: ADDRESS
              value: /var/lib/csi/sockets/pluginproxy/csi.sock
            - name: NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: POD_NAME
              valueFrom:
                fieldRef:
                  fieldPath: metadata.name
          image: registry.k8s.io/sig-storage/csi-provisioner:v3.5.0
          imagePullPolicy: IfNotPresent
          name: csi-provisioner
          resources: {}
          volumeMounts:
            - mountPath: /var/lib/csi/sockets/pluginproxy/
              name: socket-dir
        - args:
            - --endpoint=$(OPENEBS_CSI_ENDPOINT)
            - --plugin=$(OPENEBS_CONTROLLER_DRIVER)
            - --kube-api-qps=0
            - --kube-api-burst=0
          env:
            - name: OPENEBS_CONTROLLER_DRIVER
              value: controller
            - name: OPENEBS_CSI_ENDPOINT
              value: unix:///var/lib/csi/sockets/pluginproxy/csi.sock
            - name: LVM_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: OPENEBS_IO_INSTALLER_TYPE
              value: lvm-localpv-helm
            - name: OPENEBS_IO_ENABLE_ANALYTICS
              value: "true"
          image: openebs/lvm-driver:1.6.1
          imagePullPolicy: IfNotPresent
          name: openebs-lvm-plugin
          resources: {}
          volumeMounts:
            - mountPath: /var/lib/csi/sockets/pluginproxy/
              name: socket-dir
      priorityClassName: openebs-lvm-localpv-csi-controller-critical
      serviceAccountName: openebs-lvm-controller-sa
      volumes:
        - emptyDir: {}
          name: socket-dir
