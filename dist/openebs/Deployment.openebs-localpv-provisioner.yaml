apiVersion: apps/v1
kind: Deployment
metadata:
  labels:
    app: localpv-provisioner
    chart: localpv-provisioner-4.2.0
    component: localpv-provisioner
    heritage: Helm
    openebs.io/component-name: openebs-localpv-provisioner
    release: openebs
  name: openebs-localpv-provisioner
spec:
  replicas: 1
  selector:
    matchLabels:
      app: localpv-provisioner
      component: localpv-provisioner
      release: openebs
  strategy:
    type: Recreate
  template:
    metadata:
      labels:
        app: localpv-provisioner
        chart: localpv-provisioner-4.2.0
        component: localpv-provisioner
        heritage: Helm
        name: openebs-localpv-provisioner
        openebs.io/component-name: openebs-localpv-provisioner
        release: openebs
    spec:
      containers:
        - env:
            - name: OPENEBS_NAMESPACE
              valueFrom:
                fieldRef:
                  fieldPath: metadata.namespace
            - name: NODE_NAME
              valueFrom:
                fieldRef:
                  fieldPath: spec.nodeName
            - name: OPENEBS_SERVICE_ACCOUNT
              valueFrom:
                fieldRef:
                  fieldPath: spec.serviceAccountName
            - name: OPENEBS_IO_ENABLE_ANALYTICS
              value: "true"
            - name: OPENEBS_IO_BASE_PATH
              value: /var/openebs/local
            - name: OPENEBS_IO_HELPER_IMAGE
              value: openebs/linux-utils:4.1.0
            - name: OPENEBS_IO_HELPER_POD_HOST_NETWORK
              value: "false"
            - name: OPENEBS_IO_INSTALLER_TYPE
              value: localpv-charts-helm
            - name: LEADER_ELECTION_ENABLED
              value: "true"
          image: openebs/provisioner-localpv:4.2.0
          imagePullPolicy: IfNotPresent
          livenessProbe:
            exec:
              command:
                - sh
                - -c
                - test `pgrep -c "^provisioner-loc.*"` = 1
            initialDelaySeconds: 30
            periodSeconds: 60
          name: openebs-localpv-provisioner
      securityContext: {}
      serviceAccountName: openebs-localpv-provisioner
      tolerations:
        - effect: NoExecute
          key: node.kubernetes.io/unreachable
          operator: Exists
          tolerationSeconds: 5
        - effect: NoExecute
          key: node.kubernetes.io/not-ready
          operator: Exists
          tolerationSeconds: 5
