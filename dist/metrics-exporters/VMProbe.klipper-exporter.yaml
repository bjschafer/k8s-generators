apiVersion: operator.victoriametrics.com/v1beta1
kind: VMProbe
metadata:
  name: klipper-exporter
  namespace: metrics-exporters
spec:
  jobName: klipper
  params:
    modules:
      - process_stats
      - job_queue
      - system_info
      - printer_objects
      - history
  targets:
    staticConfig:
      relabelingConfigs:
        - action: replace
          sourceLabels:
            - __address__
          source_labels:
            - __address__
          targetLabel: __param_target
          target_label: __param_target
        - action: replace
          sourceLabels:
            - __param_target
          source_labels:
            - __param_target
          targetLabel: instance
          target_label: instance
        - action: replace
          replacement: klipper-exporter:9101
          targetLabel: __address__
          target_label: __address__
      targets:
        - pandora.cmdcentral.xyz:7125
        - trident.cmdcentral.xyz:7125
  vmProberSpec:
    path: /probe
    url: klipper-exporter.metrics-exporters.svc.cluster.local:9101
